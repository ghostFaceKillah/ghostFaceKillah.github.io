<html>
<head>
<style>
body {
   font-family: monospace;
    font-size:large;
    text-align: center;
    background: linear-gradient(141deg, #fffb98, #a8f6ff);
}
div {
    text-align: justify;
    max-width: 500px;
    display: inline-block;
}
img {
    max-width: 500px;
}
iframe {
    width: 500px;
    height: 280px;
}
h3 {
    text-align: center;
}
.wide {
    max-width: 750px;
}

#how_it_works_pics {
    max-width: 750px;
}
</style>
<title>Mike Garmulewicz - gf4c3 - gf4c3k1la </title>
</head>
<body>
<h2>How to build small self driving car?</h2>

<div>
My recent side project is a small self driving car.
</div>
<br><br>

<div class='wide'>
<img src="img/car/car_works_1.gif">
<img src="img/car/car_works_2.gif">
<img src="img/car/car_works_3.gif">
</div>
<br><br>

<h4>Idea</h4>

<div>
<a href='img/car/how_it_works.jpg'><img src='img/car/how_it_works_small.jpg'></a>
</div>
<br><br>

<h4>Beginnings - First car</h4>

<div>
Started the story with learning a bit about electronics.
Discovered a great book:
<a href="https://www.amazon.com/Make-Electronics-Discovery-Charles-Platt/dp/0596153740">
Make: electronics
</a>.
and learned a little bit about basic electronics.
</div>
<br><br>

<div>
<a href='img/car/blinkenlights.gif'><img src='img/car/blinkenlights.gif'></a>
</div>
<br><br>

<div>
Bought a little green car, disassembled it completely.  I didn't understand too
much about about how this stuff works, just bought the cheapest one in
Action.nl.
</div>
<br><br>

<div>
<a href='img/car/vanilla_green.jpg'><img src='img/car/vanilla_green_small.jpg'></a>
</div>
<br><br>

<div>
Deconstructed it looks like this.
</div>
<br><br>

<div>
<a href='img/car/green_basic_deconstruct.jpg'><img src='img/car/green_basic_deconstruct_small.jpg'></a>
</div>
<br><br>

<div>
Actually construction of it is really simple, there are two wires
going to battery, and two wires going to each engine front and back.
</div>
<br><br>

<div>
<a href='img/car/green/green_pcb_closeup.jpg'><img src='img/car/green/green_pcb_closeup_small.jpg'></a>
</div>
<br><br>

<div>
So we can easily figure out that
if we can control when electricty goes to the motor, we
can control motor.
</div>
<br><br>

<div>
We cannot drive the motor directly by raspi output pins though,
as the current is too high.
If we connected motor, it would damage raspi.
</div>
<br><br>

<div>
You can buy motor controller for raspi or be thrifty, and implement own.  I
have chosen to follow
<a href="https://business.tutsplus.com/tutorials/controlling-dc-motors-using-python-with-a-raspberry-pi--cms-20051">
this tutorial </a> and it worked.
</div>
<br><br>

<div>
<a href='img/car/green_engine_controller.jpg'><img src='img/car/green_engine_controller_small.jpg'></a>
</div>
<br><br>

<div>
Actually, I have learned soon that the tutorial contains a small error.
Can't drive two motors as shown
</div>
<br><br>

<div>
Read the chip factsheet, fixed the bug.
Can control car completely from raspi.
</div>
<br><br>

<div>
<iframe src='https://drive.google.com/file/d/0Bw2eHK8Zx0mLZ0ZxaVQ3UDdhNGM/preview'></iframe>
</div>
<br><br>

<h4>Construction</h4>

<div>
Implemented a basic remote control system that sends driving command over TCP
socket.  Not sure about how much power Rpi needs, bought a really big power
pack for mobile phone.  When it comes to joining stuff together, a lot of
ziptie engineering. Thanks roadkill!
</div>
<br><br>

<div>
<a href='img/car/green/green_heavy_iso_03.jpg'><img src='img/car/green/green_heavy_iso_03_small.jpg'></a>
</div>
<br><br>

<div>
<a href='img/car/green/green_heavy_iso_02.jpg'><img src='img/car/green/green_heavy_iso_02_small.jpg'></a>
</div>
<br><br>

<div>
<a href='img/car/green_ready_front.jpg'><img src='img/car/green_ready_front_small.jpg'></a>
</div>
<br><br>

<div>
<a href='img/car/green_ready_top.jpg'><img src='img/car/green_ready_top_small.jpg'></a>
</div>
<br><br>

<h4>Fail - too heavy</h4>

<div>
<iframe src='https://drive.google.com/file/d/0Bw2eHK8Zx0mLWDV1Ui1NeHNuSE0/preview'></iframe>
</div>
<br><br>

<div>
That one was way 2 heavy. Bought a way lighter battery with less capactiy.
We were really lucky about the Pokemon Go craze, as it meant a lot of cheap
mobile battery packs.
</div>
<br><br>

<div>
<a href='img/car/green_ready_light.jpg'><img src='img/car/green_ready_light_small.jpg'></a>
</div>
<br><br>

<div>
<a href='img/car/green_ready_light_side.jpg'><img src='img/car/green_ready_light_side_small.jpg'></a>
</div>
<br><br>

<h4>Camera</h4>

<div>
A lot of trial and error.  First followed
<a href="https://github.com/hamuchiwa/AutoRCCar/blob/master/raspberryPi/stream_client.py">
this 
</a> implementation, then followd where it was taken from - picamera recipes.
</div>
<br><br>

<div>
<a href='img/car/measuring_latency_03.jpg'><img src='img/car/measuring_latency_03_small.jpg'></a>
</div>
<br><br>

<div>
Measuring latency takes both hands.
</div>
<br><br>

<div>
<iframe src='https://drive.google.com/file/d/0Bw2eHK8Zx0mLSHM5X1Btam5iWEk/preview'></iframe>
</div>
<br><br>

<h4>Remote control</h4>

<div>
Remote control
first tried TCP
then tried UDP
</div>
<br><br>

<h4>Second car</h4>

<div>
<a href='img/car/black/black_vanilla.jpg'><img src='img/car/black/black_vanilla_small.jpg'></a>
</div>
<br><br>

<div>
I learned at this point that some of more advanced RC cars use more
refined servo-style motor at front. These use PWM pulse width modulation
and need a special hardware controller.
</div>
<br><br>

<div>
<a href='img/car/black/black_disassembly.jpg'><img src='img/car/black/black_disassembly_small.jpg'></a>
</div>
<br><br>

<div>
Luckily this one was not that expensive, 20-30 euro so still has simplified
steering with linear engine driving the front wheel, as tested by most direct
of methods.
</div>
<br><br>

<div>
<a href='img/car/black/black_disassembly_01.jpg'><img src='img/car/black/black_disassembly_01_small.jpg'></a>
</div>
<br><br>

<div>
Cleaned up the control module a bit and fit it into slightly
tighter package.
</div>
<br><br>

<div>
<a href='img/car/black/black_engine_controller_clean.jpg'><img src='img/car/black/black_engine_controller_clean_small.jpg'></a>
</div>
<br><br>

<div>
Cleaned up the control module a bit and fit it into slightly
tighter package.
</div>
<br><br>

<div>
<a href='img/car/black/black_iso_no_cam_2.jpg'><img src='img/car/black/black_iso_no_cam_2_small.jpg'></a>
</div>
<br><br>

<div>
Added high quality camera holder.
</div>
<br><br>

<div>
<a href='img/car/black/black_ready_iso_01.jpg'><img src='img/car/black/black_ready_iso_01_small.jpg'></a>
</div>
<br><br>

<div>
Show vid/black_is_fast
</div>
<br><br>

<h4>Machine learning</h4>

<div>
Idea was to do Nvidia paper, seen it used at Udacity
self driving car nanodegree and in comma.ai paper.
</div>
<br><br>

<div>
Did a bit data gathering, 2 sessions of around hour.
Started off with gathering one big track, around 10 meters
around the whole house.
</div>
<br><br>

<div>
Trained a neural net like in the Nvidia paper.
</div>
<br><br>

<div>
It didn't work.
</div>
<br><br>

<div>
Then decided to simplify the problem to one turn.
Gathered a lot of data another time.
</div>
<br><br>

<div>
Didn't work!
</div>
<br><br>

<div>
Annotated the data manually again to control for dynamic problems.
</div>
<br><br>

<div>
Still didn't work!
</div>
<br><br>

<div>
Cast to greyscale.
</div>
<br><br>

<div>
Implemented data augmentation based on brigthness and contrast.
</div>
<br><br>

<div>
It worked.
</div>
<br><br>

<h4>Lessons</h4>

<div>
* be patient and persistent
* need a bit of money
</div>
<br><br>
